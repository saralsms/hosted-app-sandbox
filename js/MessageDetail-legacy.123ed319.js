(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["MessageDetail"],{"020b":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Block",{staticClass:"card-base block custom-box-shadow"},[e._t("default")],2)},n=[],i=s("0814"),o={name:"CardBase",components:{Block:i["a"]}},c=o,l=s("2877"),r=Object(l["a"])(c,a,n,!1,null,"64f32f13",null);t["a"]=r.exports},"05bf":function(e,t,s){"use strict";s("857c")},"0806":function(e,t,s){"use strict";s("3bf6")},"0af5":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("InputBase",{attrs:{title:e.title,required:e.required,info:e.info,error:e.error},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.id,n=t.isInvalid;return[s("select",{ref:"input",staticClass:"form-control",class:{"is-invalid":n},attrs:{id:a,required:e.required,placeholder:e.placeholder,disabled:e.disabled},domProps:{value:e.value},on:{input:e.updateInput}},e._l(e.options,(function(t,a){return s("option",{key:a,attrs:{disabled:t.disabled,hidden:t.hidden},domProps:{selected:t.selected,value:e.getOptionValue(t)}},[e._v(" "+e._s(e.getOptionText(t))+" ")])})),0)]}}])})},n=[],i=(s("a9e3"),s("850b")),o={name:"InputSelect",components:{InputBase:i["a"]},props:{title:{type:String,default:""},options:{type:Array,default:function(){return[]}},required:{type:Boolean,default:!1},value:{type:[String,Object,Number,Boolean],default:null},optionValue:{type:String,default:""},optionText:{type:String,default:""},error:{type:String,default:""},placeholder:{type:String,default:""},info:{type:String,default:""},disabled:{type:Boolean}},methods:{updateInput:function(){this.$emit("input",this.$refs.input.value),this.$emit("select",this.$refs.input.value)},getOptionValue:function(e){return this.optionValue?e[this.optionValue]:e},getOptionText:function(e){return this.optionText?e[this.optionText]:e}}},c=o,l=s("2877"),r=Object(l["a"])(c,a,n,!1,null,null,null);t["a"]=r.exports},"1a1f":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Row",{staticClass:"mt-xl-n4 mb-4"},[s("Column",{attrs:{md:"6"}},[s("h5",{staticClass:"m-0 text-muted"},[e._t("default")],2)]),s("Column",{attrs:{md:"6"}},[s("FlexBox",{attrs:{justify:"end"}},[e._t("extra")],2)],1)],1)},n=[],i=s("1b32"),o=s("9559"),c=s("27dc"),l={name:"ContentHeader",components:{Row:c["a"],FlexBox:o["a"],Column:i["a"]}},r=l,d=s("2877"),u=Object(d["a"])(r,a,n,!1,null,"a5aed03a",null);t["a"]=u.exports},2280:function(e,t,s){"use strict";s("4922")},"3bf6":function(e,t,s){},4922:function(e,t,s){},"4cc2":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Block",[s("ContentHeader",[s("h5",{staticClass:"m-0"},[s("RouterLink",{attrs:{to:e.isScheduled?"/messages/scheduled":"/messages/sent"}},[e._v(" "+e._s(e.isScheduled?"Scheduled":"Sent")+" ")]),s("Icon",{attrs:{name:"angle-double-right"}}),e._v(" Message Detail "),e.isScheduled&&!e.isEmpty(e.message)?[s("Button",{staticClass:"p-2 mx-1 text-dark",attrs:{color:"light",title:"add recipients"},on:{click:function(t){e.isAddRecipientModalShown=!0}}},[s("Icon",{attrs:{type:"si",name:"user-follow",size:"medium"}})],1),s("Button",{staticClass:"p-2 mx-1 text-danger",attrs:{color:"light",title:"Delete this message"},on:{click:function(t){e.isDeleteModalShown=!0}}},[s("Icon",{attrs:{type:"fa",name:"trash",size:"medium"}})],1)]:e._e()],2)]),s("CardLoader",{attrs:{"is-loading":e.isLoading}},[s("Block",{staticClass:"message-details mb-1"},[s("table",{staticClass:"w-100 mb-1"},[s("tbody",[s("tr",[s("th",{staticStyle:{width:"120px"}},[e._v(" From: ")]),s("td",[e._v(" "+e._s(e.message.sender_name||" N/A")+" ")])]),s("tr",[s("th",[e._v(" To: ")]),s("td",[e.message.contacts&&e.message.contacts.length?s("read-more",{staticClass:"recipients-text",attrs:{text:e.formatContacts(e.message.contacts),"max-chars":e.getVisibleContacts(e.formatContacts(e.message.contacts),10),"more-str":"Show More","less-str":"Show Less"}}):s("span",[e._v("N/A")])],1)]),s("tr",[s("th",[e._v("Created:")]),s("td",[e._v(" "+e._s(e.message.created_at?e.duration(e.message.created_at,!0,!0):"N/A")+" ")])]),e.isScheduled?s("tr",[s("th",[e._v("Scheduled for:")]),s("td",[e._v(" "+e._s(e.message.scheduled_at?e.duration(e.message.scheduled_at,!1,!0):"N/A")+" ")])]):e._e(),s("tr",{staticClass:"border-top"},[s("td",{attrs:{colspan:"2"}},[s("p",{staticClass:"my-2 p-3 bg-light"},[e._v(" "+e._s(e.message.body)+" ")])])])])]),s("FlexBox",{staticClass:"mb-4 flex-sm-row align-items-sm-center",attrs:{direction:"column-reverse","align-items":"end",justify:"between"}},[s("FlexBox",{staticClass:"mb-3"},[s("Block",[s("Button",{staticClass:"mr-3 text-gray-800",staticStyle:{"min-width":"100px"},attrs:{color:"secondary",bordered:""},on:{click:e.onReply}},[s("Icon",{staticClass:"mr-2",attrs:{name:"reply-all"}}),e._v("Reply ")],1)],1),s("Block",[s("Button",{staticClass:"text-gray-800",staticStyle:{"min-width":"110px"},attrs:{color:"secondary",bordered:""},on:{click:e.onForward}},[s("Icon",{staticClass:"mr-2",attrs:{name:"reply-all fa-flip-horizontal"}}),e._v("Forward ")],1)],1)],1),e.isScheduled&&e.failedRecipients>0?s("FlexBox",{staticClass:"mb-3 w-100 justify-content-sm-end",attrs:{"align-items":"center",justify:"between"}},[s("h5",{staticClass:"h6 mr-3 text-danger mb-0"},[e._v(" Failed to send "+e._s(e.failedRecipients)+" recipients ")]),s("Button",{staticClass:"text-gray-800 text-white",staticStyle:{"min-width":"100px"},attrs:{color:"danger",bordered:"",disabled:e.isResending,loading:e.isResending},on:{click:e.resendFailed}},[s("Icon",{staticClass:"mr-2",attrs:{name:"repeat"}}),e._v("Re-send ")],1)],1):e._e()],1)],1),s("CardBase",{staticClass:"p-4 mb-3"},[s("Row",[s("Column",{attrs:{size:"12"}},[s("h5",[e._v(" Recipient Status ")])])],1),s("Row",[s("Column",{attrs:{md:"3"}},[s("InputSelect",{attrs:{title:"Status","option-value":"value","option-text":"name",options:e.statuses},on:{select:function(t){return e.fetchData(!1)}},model:{value:e.filters.status,callback:function(t){e.$set(e.filters,"status",t)},expression:"filters.status"}})],1),s("Column",{staticClass:"offset-md-3",attrs:{md:"6"}},[s("Search",{staticClass:"mt-4 pt-1",attrs:{placeholder:"Search recipients",debounce:500},on:{change:e.onSearch},model:{value:e.filters.keyword,callback:function(t){e.$set(e.filters,"keyword",t)},expression:"filters.keyword"}})],1)],1)],1),s("RecipientsTable",{attrs:{recipients:e.message.recipients,"contacts-length":e.message.contacts?e.message.contacts.length:0,"is-loading":e.isLoadingRecipients,"is-scheduled":e.isScheduled},on:{reload:e.fetchData}}),s("AddRecipients",{attrs:{visible:e.isAddRecipientModalShown,identifier:e.message.identifier,"exclude-contacts":e.message.contacts?e.message.contacts.map((function(e){return e.phone})):[]},on:{success:e.fetchData,close:function(t){e.isAddRecipientModalShown=!1}}}),s("DeleteMessage",{attrs:{visible:e.isDeleteModalShown,identifier:e.message.identifier},on:{success:e.onMessageDeleted,close:function(t){e.isDeleteModalShown=!1}}})],1)],1)},n=[],i=(s("99af"),s("4de4"),s("4160"),s("d81d"),s("fb6a"),s("b0c0"),s("d3b7"),s("ac1f"),s("5319"),s("159b"),s("5530")),o=s("0814"),c=s("049b"),l=s("3d8a"),r=s("1a1f"),d=s("020b"),u=s("27dc"),p=s("1b32"),h=s("dd08"),f=s("0af5"),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Block",{staticClass:"mb-4"},[s("DeleteRecipient",{attrs:{visible:e.isRemoveRecipientModalShown,recipient:e.targetRecipient,"contacts-length":e.contactsLength},on:{success:e.onRecipientRemoved,close:function(t){e.isRemoveRecipientModalShown=!1}}}),s("CardBase",{class:e.isLoading?"":"with-table"},[s("CardLoader",{attrs:{"is-loading":e.isLoading}},[s("Block",{staticClass:"table-responsive collapsible"},[e.recipients.length?s("table",{staticClass:"table m-0"},[s("thead",{staticClass:"bg-gray-lighter"},[s("tr",[s("th",{staticClass:"text-center",staticStyle:{width:"60px"}},[e._v(" # ")]),s("th",[s("span",{staticClass:"d-none d-xl-inline"},[e._v("Receiver")]),e._v(" Name ")]),s("th",[e._v(" Phone ")]),s("th",{staticStyle:{width:"100px"}},[e._v(" Status ")]),s("th",{staticClass:"text-right",staticStyle:{width:"165px"}},[e._v(" Date ")]),s("th",{staticClass:"text-right px-4",staticStyle:{width:"165px"}},[e._v(" Created ")]),s("th",{staticStyle:{width:"100px"}})])]),e.recipients.length?s("tbody",e._l(e.recipients,(function(t,a){return s("tr",{key:t.id},[s("td",{staticClass:"text-center"},[s("span",{staticClass:"hidden-info"},[e._v("#")]),s("span",[e._v(e._s(a+1))])]),s("td",[s("span",{staticClass:"hidden-info"},[e._v("Receiver:")]),s("span",{staticClass:"field-data"},[e._v(e._s(t.receiver_name||"N/A"))])]),s("td",[s("span",{staticClass:"hidden-info"},[e._v("Phone:")]),s("a",{staticClass:"link",attrs:{href:"tel:"+t.phone},on:{click:function(e){e.stopPropagation()}}},[e._v(" "+e._s(t.phone)+" ")])]),s("td",[s("span",{staticClass:"hidden-info"},[e._v("Status:")]),s("div",[s("span",{staticClass:"mr-1"},[e._v(e._s(t.status))]),"FAILED"===t.status&&t.remark?s("Icon",{attrs:{title:t.remark,type:"si",name:"info",color:"danger"}}):e._e()],1)]),s("td",{staticClass:"text-right"},[s("span",{staticClass:"hidden-info"},[e._v("Date:")]),s("span",[e._v(e._s(e.duration(t.status_date,!1,!0)))])]),s("td",{staticClass:"text-right px-4"},[s("span",{staticClass:"hidden-info"},[e._v("Created:")]),s("span",[e._v(e._s(e.duration(t.created_at)))])]),s("td",[s("span",{staticClass:"hidden-info"}),s("FlexBox",{attrs:{"align-items":"center",justify:"end"}},[s("Button",{staticClass:"p-2 mx-1 text-dark",attrs:{color:"light",title:"compose message for "+(t.name||t.phone)},on:{click:function(s){return e.onCompose(t)}}},[s("Icon",{attrs:{type:"si",name:"envelope-letter",size:"regular"}})],1),e.isScheduled?s("Button",{staticClass:"p-2 mx-1 text-danger",attrs:{color:"light",title:"remove recipient"},on:{click:function(s){return e.onRemoveRecipient(t)}}},[s("Icon",{attrs:{type:"fa",name:"trash",size:"regular"}})],1):e._e()],1)],1)])})),0):e._e()]):s("Block",{staticClass:"min-height-300 d-flex flex-row justify-content-center align-items-center"},[s("h4",{staticClass:"text-gray-dark font-w300"},[e._v(" Recipients not found ")])])],1)],1)],1)],1)},g=[],v=(s("a9e3"),s("c2cd")),b=s("9559"),C=s("ad4f"),_=s("5d35"),y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{title:"Confirmation",visible:e.visible,loading:e.isLoading,"modal-style":"max-width: 480px;"},on:{close:e.close,success:e.deleteRecipient}},[s("Block",{staticClass:"px-4"},[s("p",{staticClass:"mb-3"},[1===e.contactsLength?s("span",[e._v(" This is the only recipient and current message schedule will be removed too after deleting this. Do you like to proceed? ")]):s("span",[e._v(" Delete this recipient? ")])]),s("Block",{staticClass:"recipient-details"},[s("table",{staticClass:"w-100"},[s("tbody",[s("tr",[s("th",{staticStyle:{width:"70px"}},[e._v(" Name: ")]),s("td",[e._v(" "+e._s(e.recipient.name||" N/A")+" ")])]),s("tr",[s("th",[e._v("Phone:")]),s("td",[s("a",{staticClass:"link",attrs:{href:"tel:"+e.recipient.phone},on:{click:function(e){e.stopPropagation()}}},[e._v(" "+e._s(e.recipient.phone)+" ")])])])])])])],1)],1)},x=[],S=s("78b5"),w={name:"DeleteRecipient",components:{Block:o["a"],Modal:S["a"]},props:{visible:{type:Boolean,default:!1},contactsLength:{type:Number,default:0},recipient:{type:Object,default:function(){return{contacts:[]}}}},data:function(){return{isLoading:!1}},methods:{deleteRecipient:function(){var e=this;this.isLoading=!0,Object(l["c"])(this.recipient.recipient_id).then((function(){e.$toast.success("Recipient removed successfully!"),e.$emit("success"),e.close()})).catch((function(t){var s=t||"Couldn't remove recipient.";e.$toast.error(s)})).finally((function(){e.isLoading=!1,e.close()}))},close:function(){this.isLoading||this.$emit("close")}}},R=w,k=(s("0806"),s("2877")),B=Object(k["a"])(R,y,x,!1,null,"397b15fa",null),D=B.exports,$={name:"RecipientsTable",components:{Block:o["a"],DeleteRecipient:D,Icon:_["a"],Button:C["a"],FlexBox:b["a"],CardBase:d["a"],CardLoader:v["a"]},props:{recipients:{type:Array,default:function(){return[]}},contactsLength:{type:Number,default:0},isScheduled:{type:Boolean},isLoading:{type:Boolean}},data:function(){return{isRemoveRecipientModalShown:!1,targetRecipient:{}}},methods:{onRemoveRecipient:function(e){this.targetRecipient=e,this.isRemoveRecipientModalShown=!0},onRecipientRemoved:function(){this.contactsLength>1?this.$emit("reload"):this.$router.go(-1)},onCompose:function(e){this.$bus.emit("compose",{action:"New",recipients:[Object(i["a"])(Object(i["a"])({},e),{},{name:e.name||e.phone})]})}}},L=$,E=(s("2280"),Object(k["a"])(L,m,g,!1,null,"da3afe92",null)),M=E.exports,j=s("f137"),I=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{title:"Add new recipients","modal-style":"max-width: 500px;","hide-controls":"",visible:e.visible},on:{close:e.close}},[s("Block",{staticClass:"px-4"},[s("SelectContacts",{attrs:{"show-actions":"",taggable:"",title:"Recipients",placeholder:"Search existing or enter new recipient contacts","exclude-contacts":e.excludeContacts,"is-submitting":e.isSubmitting},on:{submit:e.onSubmit,close:e.close},model:{value:e.recipients,callback:function(t){e.recipients=t},expression:"recipients"}})],1)],1)},F=[],O=s("b0e0"),A={name:"AddRecipients",components:{SelectContacts:O["a"],Block:o["a"],Modal:S["a"]},props:{identifier:{type:String,default:""},excludeContacts:{type:Array,default:function(){return[]}},visible:{type:Boolean,default:!1}},data:function(){return{error:{},recipients:[],isLoading:!1,isSubmitting:!1,isUserFormShown:!0}},methods:{onSubmit:function(){var e=this,t=this.recipients;t.length?(this.isSubmitting=!0,Object(l["a"])(this.identifier,t.map((function(e){return e.phone}))).then((function(){e.$emit("success"),e.close()})).catch((function(t){var s=t||"Couldn't add recipients.";e.$toast.error(s)})).finally((function(){e.isSubmitting=!1}))):this.$toast.error("Please select recipients to continue")},close:function(){this.recipients=[],this.$emit("close")}}},N=A,P=Object(k["a"])(N,I,F,!1,null,"76140198",null),T=P.exports,V={name:"MessageDetail",components:{FlexBox:b["a"],AddRecipients:T,DeleteMessage:j["a"],CardLoader:v["a"],Icon:_["a"],Button:C["a"],RecipientsTable:M,InputSelect:f["a"],Search:h["a"],Column:p["a"],Row:u["a"],CardBase:d["a"],ContentHeader:r["a"],Block:o["a"]},data:function(){return{isLoading:!1,isResending:!1,isLoadingRecipients:!1,isAddRecipientModalShown:!1,isDeleteModalShown:!1,message:{contacts:[],recipients:[]},filters:{status:"",keyword:""}}},computed:{isScheduled:function(){var e=this.$route.meta.route;return"scheduled"===e},statuses:function(){return this.isScheduled?[{name:"All",value:null},{name:"Scheduled",value:"SCHEDULED"},{name:"Processed",value:"PROCESSED"},{name:"Failed",value:"FAILED"}]:[{name:"All",value:null},{name:"QUEUED",value:"QUEUED"},{name:"SENT",value:"SENT"},{name:"DELIVERED",value:"DELIVERED"},{name:"FAILED",value:"FAILED"},{name:"REFUNDED",value:"REFUNDED"}]},failedRecipients:function(){var e=this.message.recipients;return e.filter((function(e){var t=e.status;return"FAILED"===t})).length}},watch:{"$route.params":{handler:function(){this.fetchData()},immediate:!0,deep:!0}},methods:{fetchData:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&(this.isLoading=!0),this.isLoadingRecipients=!0;var s=this.$route.params.identifier,a=this.filters,n=a.status,i=a.keyword,o={status:n||null,keyword:i||null},r=null;r=this.isScheduled?Object(l["e"])(s,o):Object(c["b"])(s,o),r.then((function(t){e.message=t})).catch((function(t){e.$toast.error(t)})).finally((function(){e.isLoading=!1,e.isLoadingRecipients=!1}))},resendFailed:function(){var e=this;this.isResending=!0,Object(l["g"])(this.message.identifier).then((function(t){var s=t.message;e.$toast.success(s||"Message re-scheduled successfully."),e.fetchData(!1)})).catch((function(t){var s=t.message;e.$toast.success(s||"Message re-scheduled successfully.")})).finally((function(){e.isResending=!1}))},formatContacts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="";return e.forEach((function(e){var s="";s=e.name?'&lt;<a href="tel:'.concat(e.phone,'" class="text-small" style="text-decoration: underline">').concat(e.phone,"</a>&gt;"):'<a href="tel:'.concat(e.phone,'" class="text-small" style="text-decoration: underline">').concat(e.phone,"</a>"),t+="".concat(e.name?"".concat(e.name," "):"").concat(s,", ")})),t.replace(/[,\s]+$/gi,"")},getVisibleContacts:function(e,t){var s=this.getPosition(e,", ",t);return e.slice(0,s).length},onReply:function(){this.$bus.emit("compose",{action:"Reply",recipients:this.message.contacts.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{name:e.name||e.phone})}))})},onForward:function(){this.$bus.emit("compose",{action:"Forward",body:this.message.body})},onMessageDeleted:function(){this.$router.go(-1),this.isDeleteModalShown=!1},onSearch:function(){this.fetchData(!1)}}},U=V,z=(s("05bf"),Object(k["a"])(U,a,n,!1,null,null,null));t["default"]=z.exports},"857c":function(e,t,s){e.exports={primary:"#FF6C37",inverse:"#343a40",secondary:"#343a40",success:"#9ccc65",info:"#26c6da",warning:"#ffca28",danger:"#ef5350"}},dd08:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"input-group"},[s("input",{ref:"searchInp",staticClass:"form-control",attrs:{type:"search",placeholder:e.placeholder},domProps:{value:e.value},on:{input:e.setValue}}),e._m(0)])},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"input-group-append"},[s("span",{staticClass:"input-group-text"},[s("i",{staticClass:"fa fa-search"})])])}],i=(s("a9e3"),s("2ef0")),o={name:"Search",props:{placeholder:{type:String,default:"Search"},value:{type:String,default:""},debounce:{type:Number,default:0}},created:function(){this.debounce&&(this.onChange=Object(i["debounce"])(this.onChange,this.debounce))},methods:{setValue:function(){var e=this.$refs.searchInp.value;this.$emit("input",e),this.onChange(e)},onChange:function(e){this.$emit("change",e)}}},c=o,l=s("2877"),r=Object(l["a"])(c,a,n,!1,null,"6ec74c60",null);t["a"]=r.exports},f137:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{title:"Confirmation",visible:e.visible,loading:e.isLoading,"modal-style":"max-width: 400px;"},on:{close:e.close,success:e.deleteMessage}},[s("Block",{staticClass:"px-4"},[s("p",[e._v("Delete this scheduled message?")])])],1)},n=[],i=(s("d3b7"),s("78b5")),o=s("3d8a"),c=s("0814"),l={name:"DeleteMessage",components:{Block:c["a"],Modal:i["a"]},props:{visible:{type:Boolean,default:!1},identifier:{type:String,default:null}},data:function(){return{isLoading:!1}},methods:{deleteMessage:function(){var e=this;this.isLoading=!0,Object(o["d"])(this.identifier).then((function(){e.$toast.success("Message deleted successfully!"),e.$emit("success"),e.close()})).catch((function(t){var s=t||"Couldn't delete message.";e.$toast.error(s)})).finally((function(){e.isLoading=!1,e.close()}))},close:function(){this.isLoading||this.$emit("close")}}},r=l,d=s("2877"),u=Object(d["a"])(r,a,n,!1,null,null,null);t["a"]=u.exports}}]);